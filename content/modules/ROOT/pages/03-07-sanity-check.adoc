:imagesdir: ../assets/images
= Sanity-Check Pipeline

== What will the pipeline do?
To make sure that everything works as we would expect it, and that the model has not been tampered with, we create a sanity pipeline that tests the model through its endoint. +
We will test the response time, the response quality, and that the model hash has not changed.

== Deploy a pipeline Server in your project
Start by deploying a pipeline server that can we can use to run pipelines with:

- Go to your Data Science Project
- Scroll down to Pipelines and press "Create a pipeline server"
- Select the existing data connection "Pipelines"
- Press Create

We need to connect the pipeline server with a data connection as the pipeline server will use the S3 storage to store logs and other artifacts.

== Deploy a sanity-check pipeline
There are two pipeline files, one *sanity_check.pipeline* and one *sanity_check.yaml* file. 

The .pipeline file can be opened in Elyra to be visualliy modified and ran, while the .yaml file can be imported into the pipeline server through the dashboard. +
Here we will be running the pipeline through Elyra.

== Ad-Hoc execution
Running it through Elyra is the same as doing an ad-hoc execution of the pipeline, as opposed to importing the pipeline which won't automatically execute it.

Start by going to your workbench and open up the .pipeline file. +
Here we can see that the pipeline consists of 3 tests: a response quality test, a response time test, and a security test. Feel free to peek into each of the python files by double clicking on the nodes to see what they do. +
After the tests have been ran, we have a final function that will summarize the results and log them.

To run the pipeline, press the Play button in the menu bar.

image::03/07-elyra-pipeline.png[elyra sanity pipeline]

When you get a popup that says "Job submission to Data Science Pipelines succeeded", press the link "Run details" to see how the pipeline is progessing.

== Schedule execution
We can also schedule an execution so that the sanity check is ran at appropriate intervals. + 
To do that, go back to the dashboard, find the pipeline you just ran, press the 3 dots at the very right, and press "Create run". +

image::03/07-create-run.png[create run]

From this page, you are able to create both ad-hoc and scheduled pipeline runs. +
Name your pipeline something like "Scheduled Sanity Pipeline", select the option "Schedule recurring run", set it to run periodically every hour, and press Create. + 
We can now leave the sanity pipeline to do its thing while we are comfortable that it will start failing if something is wrong with our LLM setup.